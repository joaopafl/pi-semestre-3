@model Pi_Odonto.Models.Crianca
@{
    ViewData["Title"] = "Cadastrar Nova Criança";
    var isAdmin = ViewBag.IsAdmin == true;
}

<style>
    .container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
    }

    .header {
        background: #17a2b8;
        color: white;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 30px;
        text-align: center;
    }

    .form-container {
        background: white;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .form-group {
        margin-bottom: 20px;
    }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }

    .form-control {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 16px;
    }

        .form-control:focus {
            border-color: #17a2b8;
            outline: none;
            box-shadow: 0 0 5px rgba(23, 162, 184, 0.3);
        }

    .text-danger {
        color: #dc3545;
        font-size: 14px;
        margin-top: 5px;
    }

    .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 4px;
        text-decoration: none;
        display: inline-block;
        cursor: pointer;
        font-size: 16px;
        margin-right: 10px;
    }

    .btn-primary {
        background: #007bff;
        color: white;
    }

    .btn-secondary {
        background: #6c757d;
        color: white;
    }

    .btn:hover {
        opacity: 0.9;
    }

    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }

    .admin-info {
        background: #e7f3ff;
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 20px;
        border-left: 4px solid #007bff;
    }

    @@media (max-width: 768px) {
        .form-row

    {
        grid-template-columns: 1fr;
    }

    }
</style>

<div class="container">
    <div class="header">
        <h1>👶 Cadastrar Nova Criança</h1>
        <p>Preencha os dados da criança que deseja cadastrar</p>
        @if (isAdmin)
        {
            <small style="opacity: 0.9;">Painel Administrativo</small>
        }
    </div>

    @if (TempData["Sucesso"] != null)
    {
        <div style="background: #d4edda; color: #155724; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
            @TempData["Sucesso"]
        </div>
    }

    @if (TempData["Erro"] != null)
    {
        <div style="background: #f8d7da; color: #721c24; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
            @TempData["Erro"]
        </div>
    }

    <div class="form-container">
        <form asp-action="CadastrarCrianca" asp-controller="Perfil" method="post">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>

            @if (isAdmin)
            {
                <div class="admin-info">
                    <strong>🔧 Modo Administrador:</strong> Você pode cadastrar crianças para qualquer responsável ativo.
                </div>

                <div class="form-group">
                    <label asp-for="IdResponsavel">Responsável *</label>
                    <select asp-for="IdResponsavel" class="form-control">
                        <option value="">Selecione o responsável...</option>
                        @if (ViewBag.Responsaveis != null)
                        {
                            @foreach (var responsavel in ViewBag.Responsaveis as List<dynamic>)
                            {
                                <option value="@responsavel.Id" selected="@(Model.IdResponsavel == responsavel.Id ? "selected" : null)">
                                    @responsavel.Nome
                                </option>
                            }
                        }
                    </select>
                    <span asp-validation-for="IdResponsavel" class="text-danger"></span>
                </div>
            }
            else
            {
                <input type="hidden" asp-for="IdResponsavel" />
            }

            <div class="form-group">
                <label asp-for="Nome">Nome Completo *</label>
                <input asp-for="Nome" class="form-control" placeholder="Digite o nome completo da criança" />
                <span asp-validation-for="Nome" class="text-danger"></span>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label asp-for="Cpf">CPF *</label>
                    <input asp-for="Cpf" class="form-control" placeholder="000.000.000-00" maxlength="14" />
                    <span asp-validation-for="Cpf" class="text-danger"></span>
                </div>

                <div class="form-group">
                    <label asp-for="DataNascimento">Data de Nascimento *</label>
                    <input asp-for="DataNascimento" type="date" class="form-control" />
                    <span asp-validation-for="DataNascimento" class="text-danger"></span>
                </div>
            </div>

            <div class="form-group">
                <label asp-for="Parentesco">Parentesco *</label>
                <select asp-for="Parentesco" class="form-control">
                    <option value="">Selecione o parentesco...</option>
                    @if (ViewBag.OpcoesParentesco != null)
                    {
                        @foreach (var opcao in ViewBag.OpcoesParentesco as List<string>)
                        {
                            <option value="@opcao">@opcao</option>
                        }
                    }
                </select>
                <span asp-validation-for="Parentesco" class="text-danger"></span>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button type="submit" class="btn btn-primary">✅ Cadastrar Criança</button>
                @if (isAdmin)
                {
                    <a href="/Perfil/MinhasCriancas" class="btn btn-secondary">❌ Cancelar</a>
                }
                else
                {
                    <a href="/Perfil/MinhasCriancas" class="btn btn-secondary">❌ Cancelar</a>
                }
            </div>
        </form>
    </div>

    <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee;">
        @if (isAdmin)
        {
            <a href="/Admin" class="btn btn-secondary">⬅️ Voltar ao Painel Admin</a>
        }
        else
        {
            <a href="/Perfil" class="btn btn-secondary">⬅️ Voltar ao Perfil</a>
        }
    </div>
</div>

@section Scripts {
    <script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>

    <script>
        // Máscara para CPF
        document.querySelector('input[name="Cpf"]').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');

            // Limita a 11 dígitos
            if (value.length > 14) {
                value = value.substr(0, 11);
            }

            // Aplica a máscara
            value = value.replace(/(\d{3})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');

            e.target.value = value;
        });

        // Configurar data máxima (hoje) para data de nascimento
        document.querySelector('input[name="DataNascimento"]').setAttribute('max', new Date().toISOString().split('T')[0]);
    </script>
}